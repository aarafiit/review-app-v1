<div class="container mt-5">
  <!-- Loading Indicator -->
  <div class="text-center my-5" *ngIf="isLoading">
    <mat-icon class="loading-icon">sync</mat-icon>
    <p>Loading review details...</p>
  </div>

  <!-- Error Message -->
  <div class="alert alert-danger" *ngIf="error">
    <mat-icon>error</mat-icon> {{ error }}
  </div>

  <!-- Review Details -->
  <div class="review-details" *ngIf="!isLoading && review">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <button mat-button color="primary" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon> Back to Reviews
      </button>
      <div class="review-type-chip">
        <mat-chip
          [ngClass]="{
            'positive-chip': review.reviewType === 1,
            'negative-chip': review.reviewType === 0,
            'mixed-chip': review.reviewType === 2
          }"
          disableRipple
        >
    <span class="chip-text fw-bold">
      {{ review.reviewType === 1 ? 'Positive' : review.reviewType === 0 ? 'Negative' : 'Mixed' }}
    </span>
        </mat-chip>
      </div>

    </div>

    <mat-card class="review-card">
      <mat-card-header>
        <div mat-card-avatar class="institution-avatar">
          <mat-icon>school</mat-icon>
        </div>
        <mat-card-title>{{ review.title }}</mat-card-title>
        <mat-card-subtitle>
          {{ review.instituteName }}
          <span class="date-info">{{ review.createdAt | date : 'MMM dd, yyyy' }}</span>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Star Rating Display -->
        <div class="rating-display" *ngIf="review.rating">
          <mat-icon *ngFor="let star of getStarArray(review.rating)" color="accent">star</mat-icon>
          <mat-icon *ngFor="let star of getStarArray(5 - (review.rating || 0))" color="accent">star_border</mat-icon>
          <span class="rating-value">{{ review.rating }}/5</span>
        </div>

        <!-- Full Review Content -->
        <div class="review-content mt-4" [innerHTML]="review.description"></div>
      </mat-card-content>
    </mat-card>

    <!-- Comment Section -->
    <div class="comment-section mt-4">
      <h3>Comments</h3>

      <!-- Comment Form -->
      <mat-card class="comment-form-card">
        <mat-card-content>
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Add a comment</mat-label>
            <textarea matInput [(ngModel)]="newComment" rows="4" placeholder="Share your thoughts..."></textarea>
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-raised-button color="primary" [disabled]="!newComment.trim()" (click)="submitComment()">
            Submit Comment
          </button>
        </mat-card-actions>
      </mat-card>

      <!-- Comments List -->
      <div class="comments-list mt-4">
        <mat-card *ngFor="let comment of comments" class="comment-card mb-3">
          <mat-card-content>
            <div class="comment-date">{{ comment.createdAt | date: 'MMM dd, yyyy' }}</div>
            <div class="comment-content">{{ comment.content }}</div>
          </mat-card-content>
        </mat-card>

        <div *ngIf="comments.length === 0" class="no-comments-message">
          <p>No comments yet. Be the first to comment!</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Not Found Message -->
  <div class="text-center my-5" *ngIf="!isLoading && !review && !error">
    <mat-icon class="not-found-icon">sentiment_dissatisfied</mat-icon>
    <h3>Review Not Found</h3>
    <p>The review you're looking for doesn't exist or has been removed.</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      Back to Reviews
    </button>
  </div>
</div>
